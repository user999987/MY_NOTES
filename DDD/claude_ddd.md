根据DDD原则,一个典型的项目代码结构可能如下:

- Domain(领域层)
  - Entity(实体)
  - ValueObject(值对象)  
  - Repository(仓库)
  - Service(领域服务)

- Application(应用层)
  - Controller(控制器)
  - Command(命令)
  - Query(查询)
  - ApplicationService(应用服务)

- Infrastructure(基础设施层)
  - Data(数据访问)
    - RepositoryImpl(仓库实现)  
  - Web(Web相关)
    - ControllerImpl(控制器实现)
  - Persistence(持久化)
  - ExternalApi(外部接口)

- Shared(共享层)
  - Model(数据传输对象)
  - Exception(异常)
  -Enum(枚举)
  - Utils(工具类)

主要特点:

1. 层级分明,企业能根据需求细分层级

2. 领域层高内聚,基础设施层高耦合

3. 应用层隔离领域层与基础设施层 

4. 共享层提供公共技术

5. 面向接口编程

6. 分层且分模块

这样可以很好地保证领域模型的独立性和清晰性,同时各层职责明确。这是目前比较常见的DDD代码组织结构。


领域服务关注内部领域规则实现
应用服务关注外部用户交互流程
领域服务依赖领域模型,应用服务依赖领域服务
领域服务粒度较小,应用服务粒度较大

应用层中的Application Service通常实现了防腐层的功能和目的。


领域层中的仓库(Repository)和领域服务(Domain Service)分别指:

**仓库(Repository)**

- 负责管理某个领域模型中的一个或多个聚合类型(Aggregate)
- 提供针对具体聚合类型的基本CRUD操作
- 是领域模型对数据层的抽象访问入口

主要职责:

- 保存或加载一个聚合全部对象对象
- 根据ID查找聚合对象
- 提供多种查找聚合对象的方式(非常规功能)

**领域服务(Domain Service)**

- 负责实现领域中的复杂业务规则和流程逻辑
- 可以访问一个或多个仓库中的聚合对象
- 包含不影响对象行为的操作

主要职责:

- 协调多个聚合的交互实现业务需求
- 执行基于业务规则的操作命令
- 维持领域对象的整体一致性

区别点:

- 仓库针对单个聚合提供CRUD,服务处理多个聚合的业务规则
- 仓库给领域对象提供持久化访问,服务实现业务非核心需求
- 仓库是聚合类型的数据访问入口,服务可以访问一个或多个仓库

所以总体来说,仓库管理持久化,服务实现业务规则,二者配合构成领域模型的完整能力。