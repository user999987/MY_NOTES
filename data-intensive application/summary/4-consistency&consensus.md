# 一致性与共识
分布式系统最重要的抽象之一就是 共识（consensus）：就是让所有的节点对某件事达成一致

Paxos：Paxos是由Leslie Lamport在1989年提出的一种经典共识算法。它能够在存在最多一个故障节点的情况下，实现分布式系统的一致性。Paxos算法较为复杂，但是在分布式系统理论中有着重要的地位。

Raft：Raft是一种相对于Paxos更易理解和实现的共识算法，由Diego Ongaro和John Ousterhout在2013年提出。Raft将分布式一致性问题划分为领导者选举和日志复制两个子问题，简化了共识算法的理解和实现

Raft是一种用于分布式系统的共识算法，它是相对于Paxos更易于理解和实现的一种共识算法。由Diego Ongaro和John Ousterhout在2013年提出。

Raft算法的设计目标是使分布式系统中的多个节点能够就某个值或决策达成一致。为了实现共识，Raft将整个一致性问题划分为两个子问题：领导者选举和日志复制。

主要的Raft算法概念如下：

1. Leader（领导者）：在Raft中，有一个特殊的节点称为领导者，它负责处理客户端的请求，并将请求复制到其他节点。领导者负责发起日志条目的提交，并在整个系统中维护着最新的日志副本。如果领导者失效，其他节点会通过选举新的领导者。

2. Follower（追随者）：其他节点称为追随者，它们被 passively 从属于领导者，接收领导者的请求，并进行相应的操作。追随者能够成为领导者的候选人，并参与领导者选举。

3. Candidate（候选人）：在领导者选举过程中，节点成为候选人，并向其他节点发起投票请求，尝试成为新的领导者。

4. Term（任期）：Raft将时间分为多个连续的任期，每个任期都由一个唯一的领导者来管理。任期内只能有一个领导者。

Raft算法的核心是通过心跳机制和选举过程来维护领导者的稳定性和一致性。当系统启动或领导者失效时，会触发领导者选举过程，候选人将发送投票请求，并需要获得大多数节点的投票才能成为新的领导者。领导者定期发送心跳消息给追随者，以保持其领导地位。

Raft算法相对简单易懂，容易实现和调试。它在分布式系统中得到广泛应用，尤其在一些分布式数据库、分布式存储和区块链系统中。由于Raft的设计和理解相对简单，使得它成为学习和理解共识算法的一个很好的入门选择。

在Raft算法中，日志复制是实现共识的关键部分。日志复制的目标是确保在整个分布式系统中的所有节点都具有相同的日志副本，以保持数据的一致性和可靠性。当领导者接收到客户端的写请求时，它会将该请求作为一个新的日志条目追加到自己的日志中，并通过心跳机制将这个新的日志条目复制到其他追随者节点。

Raft算法中的日志复制流程如下：

1. 领导者接收客户端请求：当领导者接收到客户端的写请求时，它会将该请求作为一个新的日志条目追加到自己的日志中。

2. 日志条目的复制：一旦领导者将日志条目追加到自己的日志中，它会通过心跳机制将新的日志条目复制到其他追随者节点。领导者会周期性地发送心跳消息给追随者节点，告知它们最新的日志副本。

3. 追随者的确认：当追随者接收到来自领导者的心跳消息时，它会确认已经收到了领导者的最新日志副本。追随者会保持自己的日志与领导者一致。

4. 日志的提交：当领导者发现大多数节点都已经复制了某个日志条目，它会将该日志条目标记为已提交，并通知其他节点。已提交的日志条目将应用于状态机，从而执行实际的操作。

通过上述步骤，Raft算法确保了在整个分布式系统中的所有节点都具有相同的日志副本，从而实现了共识。如果领导者失效，新的领导者将继续使用上一领导者的日志进行复制，从而保持日志的一致性。通过日志复制机制，Raft算法能够抵抗节点故障，并保证数据的一致性和可靠性。

Raft是有主架构（Leader-Based Architecture）的共识算法。



一个著名的无主架构共识算法是 Practical Byzantine Fault Tolerance (PBFT)。PBFT是一种拜占庭容错的共识算法，适用于存在拜占庭节点（即可能具有恶意行为的节点）的分布式系统。在PBFT中，所有节点都是平等的，它们通过相互通信来达成共识，确保一致的共识结果。

相比于有主架构的算法（如Paxos和Raft），无主架构的算法通常较为复杂，且对节点之间的通信和协作要求较高。因此，无主架构的共识算法在实际应用中相对较少见，一般应用于对安全性要求较高的场景，如区块链系统中。